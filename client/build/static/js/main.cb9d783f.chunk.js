(this["webpackJsonprealtime-chat-app"]=this["webpackJsonprealtime-chat-app"]||[]).push([[0],{119:function(e,n){},122:function(e,n){function a(e){var n=new Error("Cannot find module '"+e+"'");throw n.code="MODULE_NOT_FOUND",n}a.keys=function(){return[]},a.resolve=a,e.exports=a,a.id=122},123:function(e,n,a){},124:function(e,n,a){},125:function(e,n,a){},126:function(e,n,a){},146:function(e,n,a){},147:function(e,n,a){},149:function(e,n,a){"use strict";a.r(n);var t=a(0),c=a.n(t),l=a(21),o=a.n(l),s=a(14),r=a(10),i=a(78),u=a.n(i),m=a(43),d=a(79),g=a.n(d),f=(a(123),a(124),a(9));function p(e){var n=e.envelope,a=n.sender,t=n.message,l=n.type;return c.a.createElement("div",null,"Me"===a?c.a.createElement(f.a,{xs:"2"}):null,c.a.createElement("div",{className:"Me"===a?"single-message__self":"single-message__other"},c.a.createElement("small",null,c.a.createElement("strong",null,a)),c.a.createElement("div",{className:"single-message__content"},"image"===l?c.a.createElement("img",{className:"single-message__image",src:t,alt:"Problem loading resource"}):t)))}a(125);function v(e){var n,a=e.user,t=e.setSendingTo,l=e.sendingTo,o=e.unreads,s=e.closeOnlineUsersModal;if(a.lastSeen&&!a.isOnline){n="last seen";var r=new Date(a.lastSeen),i=(new Date-r)/1e3;n+=i<=86400?" today at ":i<=172800?" yesterday at ":" on ".concat(r.getDate(),"/").concat(r.getMonth()+1," at "),n+=function(e){var n=e.getHours(),a=e.getMinutes(),t=n>12?"PM":"AM";return a=a<10?"0"+a:a,"".concat(n%=12,":").concat(a," ").concat(t)}(r)}return c.a.createElement("div",{className:l===a.username?"online-user-selected":"online-user",onClick:function(){t(a.username),s()}},c.a.createElement("div",{className:"online-user__icon"}),c.a.createElement("div",{className:"online-user__details"},c.a.createElement("strong",null,a.username),c.a.createElement("br",null),"conference"!==a.username?a.isOnline?"Online":a.lastSeen?n:"Offline":null),o>0?c.a.createElement("div",{className:"online-user__details__unreads"},o):null)}a(126);function _(e){var n=e.sendingTo,a=e.setSendingTo,t=e.onlineUsers;t=[{username:"conference"}].concat(Object(m.a)(t));var l=e.unreadMessagesCount,o=e.closeOnlineUsersModal;return c.a.createElement("div",{className:"online-users-list"},t.map((function(e){return c.a.createElement(v,{user:e,unreads:l[e.username],sendingTo:n,setSendingTo:a,closeOnlineUsersModal:o})})))}var b=c.a.createContext(null),h=a(80),E=a(24),w=a(8),O=a(44),y=a(53),j=a(23),k=a(81),S=a(152),C=a(153),I=a(154),N=a(155),T=new Audio("/msg_notification.mp3"),x=new Audio("/call_notification.mp3"),M=new Audio("/call_drop_notification.mp3"),A=new Audio("/ringing_tone.mp3");x.loop=!0,A.loop=!0;var z,L,U=new g.a(void 0,{secure:!0}),D={isInCall:!1,callType:null,callStatus:null,isInCallWith:null,peerIdToCall:null};function q(e,n){switch(n.type){case"outgoing-call":return{isInCall:!0,callType:"outgoing",callStatus:"ringing",isInCallWith:n.calling_to};case"outgoing-call__answered":return Object(s.a)(Object(s.a)({},e),{},{callStatus:"connected"});case"outgoing-call__declined":return{};case"incoming-call":return{isInCall:!0,callType:"incoming",callStatus:"ringing",isInCallWith:n.call_from,peerIdToCall:n.callee_peerId};case"incoming-call__answered":return Object(s.a)(Object(s.a)({},e),{},{callStatus:"connected"});case"incoming-call__declined":return{};case"call__ended":return Object(s.a)({},D);default:throw new Error}}var J,B=navigator.userAgent||navigator.vendor||window.opera,P=/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(B)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(B.substr(0,4));function R(e){var n=Object(t.useContext)(b).username,a=e.socket,l=Object(t.useRef)(null),o=Object(t.useRef)(null),i=Object(t.useRef)(null),u=Object(t.useRef)(null),d=Object(t.useState)([]),g=Object(r.a)(d,2),v=g[0],B=g[1],R=Object(t.useState)({}),F=Object(r.a)(R,2),W=F[0],G=F[1],H=Object(t.useState)({}),V=Object(r.a)(H,2),$=V[0],K=V[1],Q=Object(t.useState)(""),X=Object(r.a)(Q,2),Y=X[0],Z=X[1],ee=Object(t.useState)("conference"),ne=Object(r.a)(ee,2),ae=ne[0],te=ne[1],ce=Object(t.useState)(!0),le=Object(r.a)(ce,2),oe=le[0],se=le[1],re=Object(t.useState)(!1),ie=Object(r.a)(re,2),ue=ie[0],me=ie[1],de=function(){return me(!1)},ge=Object(t.useReducer)(q,D),fe=Object(r.a)(ge,2),pe=fe[0],ve=fe[1];function _e(e,n){var a;if((a="outgoing"===e?n.to:n.isBroadcast?"conference":n.sender)in W&&W[a].length>0){var t=[].concat(Object(m.a)(W[a]),[n]),c=Object(s.a)({},W);c[a]=t,G(c)}else{var l=[n],o=Object(s.a)({},W);o[a]=l,G(o)}}function be(e){var n;if((n=e.isBroadcast?"conference":e.sender)!==ae)if(n in $){var a=$;a[n]=a[n]+1,K(a)}else{var t=$;t[n]=1,K(t)}}function he(e){switch(clearTimeout(J),we(),"outgoing"===pe.callType&&M.play(),console.log("ending "+pe.callType+" call"),U.removeAllListeners(),e&&a.emit("end_ongoing_call",pe.isInCallWith),pe.callStatus){case"connected":z.close();break;case"ringing":Ee()}}function Ee(){u.current.srcObject=null,L&&L.getTracks().forEach((function(e){return e.stop()})),ve({type:"call__ended"})}function we(){x.pause(),x.currentTime=0,A.pause(),A.currentTime=0}return Object(t.useEffect)((function(){a.open(),a.emit("login",n,P);var e=JSON.parse(sessionStorage.getItem("conversation"));return e&&G(e),function(){a.disconnect()}}),[n,a]),Object(t.useEffect)((function(){if(l.current.scrollIntoView({block:"end"}),function(){var e=$;e[ae]=0,K(e)}(),"conference"!==ae){var e=v.findIndex((function(e){return e.username===ae}));se(v[e].isOnline)}}),[ae,W,v]),Object(t.useEffect)((function(){sessionStorage.setItem("conversation",JSON.stringify(W))}),[W]),Object(t.useEffect)((function(){a.removeAllListeners("broadcast-to-clients"),a.removeAllListeners("online-users-list"),a.removeAllListeners("personal_message"),a.removeAllListeners("disconnect"),a.on("broadcast-to-clients",(function(e){T.play(),be(e),_e("incoming",e)})),a.on("online-users-list",(function(e){var a=e.filter((function(e){return e.username!=n}));B(a)})),a.on("personal_message",(function(e){T.play(),be(e),_e("incoming",e)})),a.on("disconnect",(function(e){"io client disconnect"!==e&&a.connect()})),a.removeAllListeners("incoming_call_request"),a.on("incoming_call_request",(function(e,n){console.log("initiating call to peerId: "+e),x.play(),ve({type:"incoming-call",call_from:n,callee_peerId:e})})),a.removeAllListeners("end_ongoing_call"),a.on("end_ongoing_call",(function(){console.log("ending call due to socket event receipt"),he()}))})),Object(t.useEffect)((function(){"outgoing"===pe.callType&&"ringing"===pe.callStatus&&(J=setTimeout((function(){he(!0)}),3e4))}),[pe]),c.a.createElement(h.a,{fluid:!0,id:"chat-screen"},pe.isInCall?c.a.createElement("div",{className:"chat-screen_call_ui"},c.a.createElement("div",{className:"chat-screen_call_ui__icon"}),c.a.createElement("div",{className:"chat-screen_call_ui__details"},c.a.createElement("strong",null,pe.isInCallWith)),c.a.createElement("div",{className:"chat-screen_call_ui_actions"},"incoming"===pe.callType&&"ringing"===pe.callStatus?c.a.createElement("span",{className:"call_answer_button",onClick:function(){return we(),ve({type:"incoming-call__answered"}),void navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(e){L=e,(z=U.call(pe.peerIdToCall,e)).on("stream",(function(e){u.current.srcObject=e,console.log("stream received from call initiator user")})),z.on("close",(function(){console.log("on close() called for "+pe.callType),Ee()}))}))}},c.a.createElement(S.a,null)):null,c.a.createElement("span",{className:"call_end_button",onClick:function(){return he(!0)}},c.a.createElement(C.a,null)))):null,c.a.createElement(E.a,{id:"chat-screen__msg-area"},c.a.createElement(f.a,{xs:"3",sm:"3",id:"chat-screen__msg-area__online-users"},c.a.createElement(_,{onlineUsers:v,unreadMessagesCount:$,sendingTo:ae,setSendingTo:te,closeOnlineUsersModal:de})),c.a.createElement(f.a,{xs:"12",sm:"9",id:"chat-screen__msg-area__main"},c.a.createElement("div",{id:"chat-screen__msg-area__header"},c.a.createElement("span",{id:"chat-screen__msg-area__header__normal"},ae),c.a.createElement("span",{id:"chat-screen__msg-area__header__xs",onClick:function(){return me(!0)}},ae),c.a.createElement(O.a,{show:ue,onHide:de,centered:!0},c.a.createElement(O.a.Header,{closeButton:!0}),c.a.createElement(O.a.Body,{id:"chat-screen__mobile-device__user-list"},c.a.createElement(_,{onlineUsers:v,unreadMessagesCount:$,sendingTo:ae,setSendingTo:te,closeOnlineUsersModal:de})))),c.a.createElement("div",{className:"chat-screen__msg-area__conversation"},ae in W&&W[ae].length>0?W[ae].map((function(e){return c.a.createElement(p,{envelope:e})})):null,c.a.createElement(E.a,{className:"dummy-message",ref:l})),"conference"===ae||oe?c.a.createElement("div",{className:"chat-screen__actions"},c.a.createElement(w.a,{onSubmit:function(e){return function(e){if(e.preventDefault(),""===Y)alert("Cant send blank");else{var t={sender:n,to:ae,type:"text",message:Y,isBroadcast:"conference"===ae};"conference"===ae?a.emit("broadcast-to-server",t):a.emit("personal_message",t),t.sender="Me",_e("outgoing",t),Z("")}}(e)}},c.a.createElement(w.a.Group,{as:f.a,sm:"12",controlId:"send_message"},c.a.createElement(y.a,null,c.a.createElement(w.a.Control,{id:"chat-screen__actions__message",ref:o,size:"md",type:"text",placeholder:"Type a message",value:Y,onChange:function(e){return Z(e.target.value)},autocomplete:"off"}),c.a.createElement(y.a.Append,null,P?null:c.a.createElement(j.a,{variant:"secondary",onClick:function(){return console.log(v),void("conference"===ae?alert("Oops! Conference calls are not yet supported!"):v.find((function(e){return e.username===ae})).isMobileDevice?alert("Oops! Cannot call ".concat(ae," as the user is logged from mobile device !")):(console.log("Placing audio call request"),A.play(),a.emit("make_call_request",U.id,ae,n),ve({type:"outgoing-call",calling_to:ae}),U.on("call",(function(e){console.log("call received from another user"),we(),ve({type:"outgoing-call__answered"}),navigator.mediaDevices.getUserMedia({audio:!0,video:!1}).then((function(n){L=n,z=e,e.answer(n),e.on("stream",(function(e){u.current.srcObject=e,console.log("Stream received from calling to user")})),z.on("close",(function(){console.log("on close() called for "+pe.callType),Ee()}))}))}))))}},c.a.createElement(I.a,null)),c.a.createElement(j.a,{variant:"secondary",onClick:function(){i.current.click()}},c.a.createElement(N.a,null)),c.a.createElement(w.a.File,{id:"chat-screen__actions__file",accept:"image/*",ref:i,onChange:function(e){return function(e){var t=e.target.files[0],c=new FileReader;c.readAsDataURL(t),c.onload=function(){var e=c.result,t={sender:n,to:ae,type:"image",message:e,isBroadcast:"conference"===ae};"conference"===ae?a.emit("broadcast-to-server",t):a.emit("personal_message",t),t.sender="Me",_e("outgoing",t)}}(e)}})))))):c.a.createElement(k.a,{variant:"light"},"Messages cannot be sent as ",ae," is Offline"))),c.a.createElement("video",{className:"chat-screen__mediastream",autoplay:"true",id:"mediaDiv",ref:u}))}var F=a(82),W=a.n(F);a(146);function G(){var e=Object(t.useContext)(b),n=Object(t.useState)(!1),a=Object(r.a)(n,2),l=a[0],o=a[1],s=Object(t.useState)(""),i=Object(r.a)(s,2),u=i[0],m=i[1],d=Object(t.useState)(""),g=Object(r.a)(d,2),p=g[0],v=g[1];return c.a.createElement(w.a,{className:"login-form",noValidate:!0,validated:l,onSubmit:function(n){if(n.preventDefault(),!1===n.currentTarget.checkValidity())n.stopPropagation(),o(!0);else{var a={username:u,password:p};W.a.post("".concat(window.location.href,"login"),a).then((function(n){200===n.status&&(sessionStorage.setItem("username",JSON.stringify(u)),sessionStorage.setItem("loggedIn",JSON.stringify(!0)),e.dispatch({type:"login",username:u}))})).catch((function(e){e&&(!e.response||401!==e.response.status&&403!==e.response.status?alert("Something went wrong. Please try later"):alert(e.response.data))}))}}},c.a.createElement(w.a.Group,{as:E.a,className:"justify-content-center",controlId:"validate_login_username"},c.a.createElement(f.a,{sm:"2",md:"1"},c.a.createElement(w.a.Label,null,"Username")),c.a.createElement(f.a,{sm:"4",md:"4"},c.a.createElement(w.a.Control,{type:"text",size:"sm",value:u,onChange:function(e){return m(e.target.value)},required:!0,autocomplete:"off",autoFocus:!0}),c.a.createElement(w.a.Control.Feedback,{type:"invalid"},"Please provide username"))),c.a.createElement(w.a.Group,{as:E.a,className:"justify-content-center",controlId:"validate_login_password"},c.a.createElement(f.a,{sm:"2",md:"1"},c.a.createElement(w.a.Label,null,"Password")),c.a.createElement(f.a,{sm:"4",md:"4"},c.a.createElement(w.a.Control,{type:"password",size:"sm",value:p,onChange:function(e){return v(e.target.value)},required:!0}),c.a.createElement(w.a.Control.Feedback,{type:"invalid"},"Please provide password"))),c.a.createElement(w.a.Group,{as:E.a,className:"justify-content-center"},c.a.createElement(f.a,{sm:"4",md:"4"}),c.a.createElement(f.a,{sm:"2",md:"1"},c.a.createElement(j.a,{className:"btn-block",type:"submit"},"Login"))))}a(147);var H=a(54),V=a(83),$=u()({secure:!0});function K(e,n){switch(n.type){case"login":return{loggedIn:!0,username:n.username};case"logout":return{loggedIn:!1,username:null};default:throw new Error}}var Q=function(){var e=Object(t.useReducer)(K,{username:JSON.parse(sessionStorage.getItem("username"))||"",loggedIn:JSON.parse(sessionStorage.getItem("loggedIn"))||!1}),n=Object(r.a)(e,2),a=n[0],l=n[1],o=function(){sessionStorage.setItem("username",JSON.stringify(null)),sessionStorage.setItem("loggedIn",JSON.stringify(!1)),$.connected&&$.close(),l({type:"logout"})},i=Object(s.a)(Object(s.a)({},a),{},{dispatch:l});return c.a.createElement(b.Provider,{value:i},c.a.createElement(H.a,{className:"header",expand:"lg",sticky:"top"},c.a.createElement(H.a.Brand,null,"Instant Messenger"),!0===a.loggedIn?c.a.createElement(c.a.Fragment,null,c.a.createElement(V.a,{className:"ml-auto"},c.a.createElement(j.a,{variant:"outline-secondary",size:"sm",onClick:o},"Logout"))):null),!0===a.loggedIn?c.a.createElement(R,{handleLogout:o,socket:$}):c.a.createElement(G,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));a(148);o.a.render(c.a.createElement(c.a.StrictMode,null,c.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))},84:function(e,n,a){e.exports=a(149)}},[[84,1,2]]]);
//# sourceMappingURL=main.cb9d783f.chunk.js.map